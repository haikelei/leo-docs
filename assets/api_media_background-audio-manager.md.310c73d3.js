import{_ as t,c as e,o as l,N as a}from"./chunks/framework.fc67cb9d.js";const f=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"api/media/background-audio-manager.md","lastUpdated":1685603474000}'),n={name:"api/media/background-audio-manager.md"},s=a(`<h3 id="uni-getbackgroundaudiomanager" tabindex="-1">uni.getBackgroundAudioManager() <a class="header-anchor" href="#uni-getbackgroundaudiomanager" aria-label="Permalink to &quot;uni.getBackgroundAudioManager()&quot;">​</a></h3><p>获取<strong>全局唯一</strong>的背景音频管理器 <code>backgroundAudioManager</code>。</p><p>背景音频，不是游戏的背景音乐，而是类似QQ音乐那样，App在后台时，仍然在播放音乐。如果你不需要在App切后台时继续播放，那么不应该使用本API，而应该使用普通音频API<a href="https://uniapp.dcloud.io/api/media/audio-context" target="_blank" rel="noreferrer">uni.createInnerAudioContext</a>。</p><p><strong>平台差异说明</strong></p><table><thead><tr><th style="text-align:center;">App</th><th style="text-align:center;">H5</th><th style="text-align:center;">微信小程序</th><th style="text-align:center;">支付宝小程序</th><th style="text-align:center;">百度小程序</th><th style="text-align:center;">字节跳动小程序</th><th style="text-align:center;">飞书小程序</th><th style="text-align:center;">QQ小程序</th><th style="text-align:center;">快手小程序</th><th style="text-align:center;">京东小程序</th></tr></thead><tbody><tr><td style="text-align:center;">√</td><td style="text-align:center;">x</td><td style="text-align:center;">√</td><td style="text-align:center;">x</td><td style="text-align:center;">√</td><td style="text-align:center;">√</td><td style="text-align:center;">x</td><td style="text-align:center;">√</td><td style="text-align:center;">x</td><td style="text-align:center;">√</td></tr></tbody></table><p><strong>backgroundAudioManager 对象的属性列表</strong></p><table><thead><tr><th style="text-align:left;">属性</th><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th><th style="text-align:left;">只读</th></tr></thead><tbody><tr><td style="text-align:left;">duration</td><td style="text-align:left;">Number</td><td style="text-align:left;">当前音频的长度（单位：s），只有在当前有合法的 src 时返回</td><td style="text-align:left;">是</td></tr><tr><td style="text-align:left;">currentTime</td><td style="text-align:left;">Number</td><td style="text-align:left;">当前音频的播放位置（单位：s），只有在当前有合法的 src 时返回</td><td style="text-align:left;">是</td></tr><tr><td style="text-align:left;">paused</td><td style="text-align:left;">Boolean</td><td style="text-align:left;">当前是是否暂停或停止状态，true 表示暂停或停止，false 表示正在播放</td><td style="text-align:left;">是</td></tr><tr><td style="text-align:left;">src</td><td style="text-align:left;">String</td><td style="text-align:left;">音频的数据源，默认为空字符串，**当设置了新的 src 时，会自动开始播放，**目前支持的格式有 m4a, aac, mp3, wav</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">startTime</td><td style="text-align:left;">Number</td><td style="text-align:left;">音频开始播放的位置（单位：s）</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">buffered</td><td style="text-align:left;">Number</td><td style="text-align:left;">音频缓冲的时间点，仅保证当前播放时间点到此时间点内容已缓冲。</td><td style="text-align:left;">是</td></tr><tr><td style="text-align:left;">title</td><td style="text-align:left;">String</td><td style="text-align:left;">音频标题，用于做原生音频播放器音频标题。原生音频播放器中的分享功能，分享出去的卡片标题，也将使用该值。</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">epname</td><td style="text-align:left;">String</td><td style="text-align:left;">专辑名，原生音频播放器中的分享功能，分享出去的卡片简介，也将使用该值。</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">singer</td><td style="text-align:left;">String</td><td style="text-align:left;">歌手名，原生音频播放器中的分享功能，分享出去的卡片简介，也将使用该值。</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">coverImgUrl</td><td style="text-align:left;">String</td><td style="text-align:left;">封面图url，用于做原生音频播放器背景图。原生音频播放器中的分享功能，分享出去的卡片配图及背景也将使用该图。</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">webUrl</td><td style="text-align:left;">String</td><td style="text-align:left;">页面链接，原生音频播放器中的分享功能，分享出去的卡片简介，也将使用该值。</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">protocol</td><td style="text-align:left;">String</td><td style="text-align:left;">音频协议。默认值为 &#39;http&#39;，设置 &#39;hls&#39; 可以支持播放 HLS 协议的直播音频，App平台暂不支持</td><td style="text-align:left;">否</td></tr><tr><td style="text-align:left;">playbackRate</td><td style="text-align:left;">Number</td><td style="text-align:left;">播放的倍率。可取值：0.5/0.8/1.0/1.25/1.5/2.0，默认值为1.0。(App 3.4.5+、微信基础库 2.11.0+、支付宝小程序、字节小程序 2.33.0+、快手小程序、百度小程序 3.120.2+)</td><td style="text-align:left;">否</td></tr></tbody></table><p><strong>backgroundAudioManager 对象的方法列表</strong></p><table><thead><tr><th style="text-align:left;">方法</th><th style="text-align:left;">参数</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">play</td><td style="text-align:left;"></td><td style="text-align:left;">播放</td></tr><tr><td style="text-align:left;">pause</td><td style="text-align:left;"></td><td style="text-align:left;">暂停</td></tr><tr><td style="text-align:left;">stop</td><td style="text-align:left;"></td><td style="text-align:left;">停止</td></tr><tr><td style="text-align:left;">seek</td><td style="text-align:left;">position</td><td style="text-align:left;">跳转到指定位置，单位 s</td></tr><tr><td style="text-align:left;">onCanplay</td><td style="text-align:left;">callback</td><td style="text-align:left;">背景音频进入可以播放状态，但不保证后面可以流畅播放</td></tr><tr><td style="text-align:left;">onPlay</td><td style="text-align:left;">callback</td><td style="text-align:left;">背景音频播放事件</td></tr><tr><td style="text-align:left;">onPause</td><td style="text-align:left;">callback</td><td style="text-align:left;">背景音频暂停事件</td></tr><tr><td style="text-align:left;">onStop</td><td style="text-align:left;">callback</td><td style="text-align:left;">背景音频停止事件</td></tr><tr><td style="text-align:left;">onEnded</td><td style="text-align:left;">callback</td><td style="text-align:left;">背景音频自然播放结束事件</td></tr><tr><td style="text-align:left;">onTimeUpdate</td><td style="text-align:left;">callback</td><td style="text-align:left;">背景音频播放进度更新事件</td></tr><tr><td style="text-align:left;">onPrev</td><td style="text-align:left;">callback</td><td style="text-align:left;">用户在系统音乐播放面板点击上一曲事件（iOS only）</td></tr><tr><td style="text-align:left;">onNext</td><td style="text-align:left;">callback</td><td style="text-align:left;">用户在系统音乐播放面板点击下一曲事件（iOS only）</td></tr><tr><td style="text-align:left;">onError</td><td style="text-align:left;">callback</td><td style="text-align:left;">背景音频播放错误事件</td></tr><tr><td style="text-align:left;">onWaiting</td><td style="text-align:left;">callback</td><td style="text-align:left;">音频加载中事件，当音频因为数据不足，需要停下来加载时会触发</td></tr></tbody></table><p>errCode 说明</p><table><thead><tr><th style="text-align:left;">errCode</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">10001</td><td style="text-align:left;">系统错误</td></tr><tr><td style="text-align:left;">10002</td><td style="text-align:left;">网络错误</td></tr><tr><td style="text-align:left;">10003</td><td style="text-align:left;">文件错误</td></tr><tr><td style="text-align:left;">10004</td><td style="text-align:left;">格式错误</td></tr><tr><td style="text-align:left;">-1</td><td style="text-align:left;">未知错误</td></tr></tbody></table><p><strong>示例</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> bgAudioManager </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getBackgroundAudioManager</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">bgAudioManager</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">title </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">致爱丽丝</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">bgAudioManager</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">singer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">暂无</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">bgAudioManager</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">coverImgUrl </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://web-assets.dcloud.net.cn/unidoc/zh/music-a.png</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">bgAudioManager</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://bjetxgzv.cdn.bspapp.com/VKCEYUGU-hello-uniapp/2cc220e0-c27a-11ea-9dfb-6da8e309e0d8.mp3</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><strong>注意</strong> 因为背景音频播放耗费手机电量，所以平台都有管控，需在manifest中填写申请。</p><ul><li>ios App平台，背景播放需在manifest.json -&gt; app-plus -&gt; distribute -&gt; ios 节点添加 <code>&quot;UIBackgroundModes&quot;:[&quot;audio&quot;]</code> 才能保证音乐可以后台播放（打包成ipa生效）</li><li>小程序平台，需在manifest.json 对应的小程序节点下，填写&quot;requiredBackgroundModes&quot;: [&quot;audio&quot;]。发布小程序时平台会审核</li><li>Android App端默认不会在通知栏出现音量控制，如需此功能，需要在插件市场单独下载原生插件，<a href="https://ext.dcloud.net.cn/search?q=%E9%80%9A%E7%9F%A5%E6%A0%8F+%E9%9F%B3%E4%B9%90%E6%8E%A7%E5%88%B6" target="_blank" rel="noreferrer">详见</a></li></ul>`,15),d=[s];function r(i,o,g,y,p,c){return l(),e("div",null,d)}const u=t(n,[["render",r]]);export{f as __pageData,u as default};
