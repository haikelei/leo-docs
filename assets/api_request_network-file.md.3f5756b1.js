import{_ as l,c as a,o as e,N as t,x as s}from"./chunks/framework.fc67cb9d.js";const C=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"api/request/network-file.md","lastUpdated":1685603474000}'),n={name:"api/request/network-file.md"},o=t(`<h3 id="uni-uploadfile-object" tabindex="-1">uni.uploadFile(OBJECT) <a class="header-anchor" href="#uni-uploadfile-object" aria-label="Permalink to &quot;uni.uploadFile(OBJECT)&quot;">​</a></h3><p>将本地资源上传到开发者服务器，客户端发起一个 <code>POST</code> 请求，其中 <code>content-type</code> 为 <code>multipart/form-data</code>。 如页面通过 <a href="./api/media/image.html?id=chooseimage">uni.chooseImage</a> 等接口获取到一个本地资源的临时文件路径后，可通过此接口将本地资源上传到指定服务器。另外选择和上传非图像、视频文件参考：<a href="https://ask.dcloud.net.cn/article/35547" target="_blank" rel="noreferrer">https://ask.dcloud.net.cn/article/35547</a>。</p><blockquote><p>在各个小程序平台运行时，网络相关的 API 在使用前需要配置域名白名单。</p></blockquote><p><strong>推荐开发者上传到uniCloud，uniCloud提供了免费CDN和更好的易用性，包括安全的cdn直传。</strong></p><ul><li>uniCloud的上传API：<a href="https://uniapp.dcloud.io/uniCloud/storage?id=uploadfile" target="_blank" rel="noreferrer">https://uniapp.dcloud.io/uniCloud/storage?id=uploadfile</a></li><li>封装的更完善的<a href="https://ext.dcloud.net.cn/plugin?id=4079" target="_blank" rel="noreferrer">uni-file-picker组件</a>，文件选择、上传到uniCloud，一站式集成。</li></ul><p><strong>OBJECT 参数说明</strong></p><table><thead><tr><th style="text-align:left;">参数名</th><th style="text-align:left;">类型</th><th style="text-align:left;">必填</th><th style="text-align:left;">说明</th><th style="text-align:left;">平台差异说明</th></tr></thead><tbody><tr><td style="text-align:left;">url</td><td style="text-align:left;">String</td><td style="text-align:left;">是</td><td style="text-align:left;">开发者服务器 url</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">files</td><td style="text-align:left;">Array</td><td style="text-align:left;">是（files和filePath选其一）</td><td style="text-align:left;">需要上传的文件列表。<strong>使用 files 时，filePath 和 name 不生效。</strong></td><td style="text-align:left;">App、H5（ 2.6.15+）</td></tr><tr><td style="text-align:left;">fileType</td><td style="text-align:left;">String</td><td style="text-align:left;">见平台差异说明</td><td style="text-align:left;">文件类型，image/video/audio</td><td style="text-align:left;">仅支付宝小程序，且必填。</td></tr><tr><td style="text-align:left;">file</td><td style="text-align:left;">File</td><td style="text-align:left;">否</td><td style="text-align:left;">要上传的文件对象。</td><td style="text-align:left;">仅H5（2.6.15+）支持</td></tr><tr><td style="text-align:left;">filePath</td><td style="text-align:left;">String</td><td style="text-align:left;">是（files和filePath选其一）</td><td style="text-align:left;">要上传文件资源的路径。</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">name</td><td style="text-align:left;">String</td><td style="text-align:left;">是</td><td style="text-align:left;">文件对应的 key , 开发者在服务器端通过这个 key 可以获取到文件二进制内容</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">header</td><td style="text-align:left;">Object</td><td style="text-align:left;">否</td><td style="text-align:left;">HTTP 请求 Header, header 中不能设置 Referer。</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">timeout</td><td style="text-align:left;">Number</td><td style="text-align:left;">否</td><td style="text-align:left;">超时时间，单位 ms</td><td style="text-align:left;">H5(HBuilderX 2.9.9+)、APP(HBuilderX 2.9.9+)、微信小程序、支付宝小程序、字节跳动小程序、快手小程序</td></tr><tr><td style="text-align:left;">formData</td><td style="text-align:left;">Object</td><td style="text-align:left;">否</td><td style="text-align:left;">HTTP 请求中其他额外的 form data</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">success</td><td style="text-align:left;">Function</td><td style="text-align:left;">否</td><td style="text-align:left;">接口调用成功的回调函数</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">fail</td><td style="text-align:left;">Function</td><td style="text-align:left;">否</td><td style="text-align:left;">接口调用失败的回调函数</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">complete</td><td style="text-align:left;">Function</td><td style="text-align:left;">否</td><td style="text-align:left;">接口调用结束的回调函数（调用成功、失败都会执行）</td><td style="text-align:left;"> </td></tr></tbody></table><p><strong>注意</strong>：</p><ul><li>App支持多文件上传，微信小程序只支持单文件上传，传多个文件需要反复调用本API。所以跨端的写法就是循环调用本API。</li><li>hello uni-app中的客服反馈，支持多图上传。<a href="https://ext.dcloud.net.cn/" target="_blank" rel="noreferrer">uni-app插件市场</a>中也有多个封装的组件。</li><li>App平台选择和上传非图像、视频文件，参考<a href="https://ask.dcloud.net.cn/article/35547" target="_blank" rel="noreferrer">https://ask.dcloud.net.cn/article/35547</a></li><li>网络请求的 <code>超时时间</code> 可以统一在 <code>manifest.json</code> 中配置 <a href="/leo-docs/collocation/manifest.html?id=networktimeout">networkTimeout</a>。</li><li>支付宝小程序开发工具上传文件返回的http状态码为字符串形式，支付宝小程序真机返回的状态码为数字形式</li></ul><p><strong>files参数说明</strong></p><p>files 参数是一个 file 对象的数组，file 对象的结构如下：</p><table><thead><tr><th style="text-align:left;">参数名</th><th style="text-align:left;">类型</th><th style="text-align:left;">必填</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">name</td><td style="text-align:left;">String</td><td style="text-align:left;">否</td><td style="text-align:left;">multipart 提交时，表单的项目名，默认为 file</td></tr><tr><td style="text-align:left;">file</td><td style="text-align:left;">File</td><td style="text-align:left;">否</td><td style="text-align:left;">要上传的文件对象，仅H5（2.6.15+）支持</td></tr><tr><td style="text-align:left;">uri</td><td style="text-align:left;">String</td><td style="text-align:left;">是</td><td style="text-align:left;">文件的本地地址</td></tr></tbody></table><p>Tip:</p><ul><li>如果 <code>name</code> 不填或填的值相同，可能导致服务端读取文件时只能读取到一个文件。</li></ul><p><strong>success 返回参数说明</strong></p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">data</td><td style="text-align:left;">String</td><td style="text-align:left;">开发者服务器返回的数据</td></tr><tr><td style="text-align:left;">statusCode</td><td style="text-align:left;">Number</td><td style="text-align:left;">开发者服务器返回的 HTTP 状态码</td></tr></tbody></table><p><strong>示例</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">chooseImage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">success</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">chooseImageRes</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tempFilePaths</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chooseImageRes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tempFilePaths</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">uploadFile</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			url</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://www.example.com/upload</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">//仅为示例，非真实的接口地址</span></span>
<span class="line"><span style="color:#F07178;">			filePath</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tempFilePaths</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">			name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">file</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">			formData</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">test</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#82AAFF;">success</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">uploadFileRes</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">uploadFileRes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><strong>返回值</strong></p><p>如果希望返回一个 <code>uploadTask</code> 对象，需要至少传入 success / fail / complete 参数中的一个。例如：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> uploadTask </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">uploadFile</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://www.example.com/upload</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//仅为示例，并非真实接口地址。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">complete</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">uploadTask</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">abort</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>如果没有传入 success / fail / complete 参数，则会返回封装后的 Promise 对象：<a href="/leo-docs/api/README.html?id=promise-封装">Promise 封装</a></p><p>通过 <code>uploadTask</code>，可监听上传进度变化事件，以及取消上传任务。</p><p><strong>uploadTask 对象的方法列表</strong></p><table><thead><tr><th style="text-align:left;">方法</th><th style="text-align:left;">参数</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">abort</td><td style="text-align:left;"></td><td style="text-align:left;">中断上传任务</td></tr><tr><td style="text-align:left;">onProgressUpdate</td><td style="text-align:left;">callback</td><td style="text-align:left;">监听上传进度变化</td></tr><tr><td style="text-align:left;">onHeadersReceived</td><td style="text-align:left;">callback</td><td style="text-align:left;">监听 HTTP Response Header 事件。会比请求完成事件更早,仅<code>微信小程序平台</code>支持，<a href="https://developers.weixin.qq.com/miniprogram/dev/api/UploadTask.onHeadersReceived.html" target="_blank" rel="noreferrer">规范详情</a></td></tr><tr><td style="text-align:left;">offProgressUpdate</td><td style="text-align:left;">callback</td><td style="text-align:left;">取消监听上传进度变化事件，仅<code>微信小程序平台</code>支持，<a href="https://developers.weixin.qq.com/miniprogram/dev/api/UploadTask.offProgressUpdate.html" target="_blank" rel="noreferrer">规范详情</a></td></tr><tr><td style="text-align:left;">offHeadersReceived</td><td style="text-align:left;">callback</td><td style="text-align:left;">取消监听 HTTP Response Header 事件，仅<code>微信小程序平台</code>支持，<a href="https://developers.weixin.qq.com/miniprogram/dev/api/UploadTask.offHeadersReceived.html" target="_blank" rel="noreferrer">规范详情</a></td></tr></tbody></table><p><strong>onProgressUpdate 返回参数说明</strong></p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">progress</td><td style="text-align:left;">Number</td><td style="text-align:left;">上传进度百分比</td></tr><tr><td style="text-align:left;">totalBytesSent</td><td style="text-align:left;">Number</td><td style="text-align:left;">已经上传的数据长度，单位 Bytes</td></tr><tr><td style="text-align:left;">totalBytesExpectedToSend</td><td style="text-align:left;">Number</td><td style="text-align:left;">预期需要上传的数据总长度，单位 Bytes</td></tr></tbody></table><p><strong>示例</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">chooseImage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">success</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">chooseImageRes</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tempFilePaths</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chooseImageRes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tempFilePaths</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uploadTask</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">uploadFile</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			url</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://www.example.com/upload</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">//仅为示例，非真实的接口地址</span></span>
<span class="line"><span style="color:#F07178;">			filePath</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tempFilePaths</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">			name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">file</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">			formData</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">user</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">test</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#82AAFF;">success</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">uploadFileRes</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">uploadFileRes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">uploadTask</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onProgressUpdate</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">上传进度</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">progress</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">已经上传的数据长度</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">totalBytesSent</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">预期需要上传的数据总长度</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">totalBytesExpectedToSend</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;font-style:italic;">// 测试条件，取消上传任务。</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">progress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">50</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">				</span><span style="color:#A6ACCD;">uploadTask</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">abort</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="uni-downloadfile-object-downloadfile" tabindex="-1">uni.downloadFile(OBJECT)@downloadfile <a class="header-anchor" href="#uni-downloadfile-object-downloadfile" aria-label="Permalink to &quot;uni.downloadFile(OBJECT)@downloadfile&quot;">​</a></h3><p>下载文件资源到本地，客户端直接发起一个 HTTP GET 请求，返回文件的本地临时路径。</p><blockquote><p>在各个小程序平台运行时，网络相关的 API 在使用前需要配置域名白名单。在h5上是跨域的，用户需要处理好跨域问题。</p></blockquote><p><strong>OBJECT 参数说明</strong></p>`,33),p=s("table",null,[s("thead",null,[s("tr",null,[s("th",{style:{"text-align":"left"}},"参数名"),s("th",{style:{"text-align":"left"}},"类型"),s("th",{style:{"text-align":"left"}},"必填"),s("th",{style:{"text-align":"left"}},"说明"),s("th",{style:{"text-align":"left"}},"平台差异说明")])]),s("tbody",null,[s("tr",null,[s("td",{style:{"text-align":"left"}},"url"),s("td",{style:{"text-align":"left"}},"String"),s("td",{style:{"text-align":"left"}},"是"),s("td",{style:{"text-align":"left"}},"下载资源的 url"),s("td",{style:{"text-align":"left"}})]),s("tr",null,[s("td",{style:{"text-align":"left"}},"header"),s("td",{style:{"text-align":"left"}},"Object"),s("td",{style:{"text-align":"left"}},"否"),s("td",{style:{"text-align":"left"}},"HTTP 请求 Header, header 中不能设置 Referer。"),s("td",{style:{"text-align":"left"}})]),s("tr",null,[s("td",{style:{"text-align":"left"}},"timeout"),s("td",{style:{"text-align":"left"}},"Number"),s("td",{style:{"text-align":"left"}},"否"),s("td",{style:{"text-align":"left"}},"超时时间，单位 ms"),s("td",{style:{"text-align":"left"}},"H5(HBuilderX 2.9.9+)、APP(HBuilderX 2.9.9+)、微信小程序、支付宝小程序、字节跳动小程序、快手小程序")]),s("tr",null,[s("td",{style:{"text-align":"left"}},"filePath"),s("td",{style:{"text-align":"left"}},"string"),s("td",{style:{"text-align":"left"}},"否"),s("td",{style:{"text-align":"left"}},"指定文件下载后存储的路径 (本地路径)"),s("td",{style:{"text-align":"left"}},"小程序端支持（微信IOS小程序保存到相册需要添加此字段才可以正常保存）")]),s("tr",null,[s("td",{style:{"text-align":"left"}},"success"),s("td",{style:{"text-align":"left"}},"Function"),s("td",{style:{"text-align":"left"}},"否"),s("td",{style:{"text-align":"left"},"tempFilePath:":"",文件的临时路径:""},"下载成功后以 tempFilePath 的形式传给页面，res ="),s("td",{style:{"text-align":"left"}})]),s("tr",null,[s("td",{style:{"text-align":"left"}},"fail"),s("td",{style:{"text-align":"left"}},"Function"),s("td",{style:{"text-align":"left"}},"否"),s("td",{style:{"text-align":"left"}},"接口调用失败的回调函数"),s("td",{style:{"text-align":"left"}})]),s("tr",null,[s("td",{style:{"text-align":"left"}},"complete"),s("td",{style:{"text-align":"left"}},"Function"),s("td",{style:{"text-align":"left"}},"否"),s("td",{style:{"text-align":"left"}},"接口调用结束的回调函数（调用成功、失败都会执行）"),s("td",{style:{"text-align":"left"}})])])],-1),r=t(`<p><strong>注：文件的临时路径，在应用本次启动期间可以正常使用，如需持久保存，需在主动调用 <a href="/leo-docs/api/file/file.html?id=savefile">uni.saveFile</a>，才能在应用下次启动时访问得到。</strong></p><p><strong>success 返回参数说明</strong></p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th><th style="text-align:left;">平台差异说明</th></tr></thead><tbody><tr><td style="text-align:left;">tempFilePath</td><td style="text-align:left;">String</td><td style="text-align:left;">临时文件路径，下载后的文件会存储到一个临时文件</td><td style="text-align:left;">微信小程序、支付宝小程序、百度小程序、字节跳动小程序、飞书小程序</td></tr><tr><td style="text-align:left;">statusCode</td><td style="text-align:left;">Number</td><td style="text-align:left;">开发者服务器返回的 HTTP 状态码</td><td style="text-align:left;">微信小程序、QQ小程序、百度小程序、字节跳动小程序、飞书小程序</td></tr><tr><td style="text-align:left;">apFilePath</td><td style="text-align:left;">String</td><td style="text-align:left;">下载文件保存的路径（本地临时文件）。入参未指定 filePath 的情况下可用</td><td style="text-align:left;">支付宝小程序</td></tr><tr><td style="text-align:left;">filePath</td><td style="text-align:left;">String</td><td style="text-align:left;">用户文件路径 (本地路径)。传入 filePath 时会返回，跟传入的 filePath 一致</td><td style="text-align:left;">微信小程序、支付宝小程序、字节跳动小程序、飞书小程序</td></tr><tr><td style="text-align:left;">fileContent</td><td style="text-align:left;">Buffer</td><td style="text-align:left;">文件内容</td><td style="text-align:left;">QQ小程序</td></tr></tbody></table><p><strong>注意</strong></p><ul><li>网络请求的 <code>超时时间</code> 可以统一在 <code>manifest.json</code> 中配置 <a href="/leo-docs/collocation/manifest.html?id=networktimeout">networkTimeout</a>。</li></ul><p><strong>示例</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">downloadFile</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://www.example.com/file/test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//仅为示例，并非真实的资源</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">success</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">statusCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">下载成功</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p><strong>返回值</strong></p><p>如果希望返回一个 <code>downloadTask</code> 对象，需要至少传入 success / fail / complete 参数中的一个。例如：</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> downloadTask </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">downloadFile</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://www.example.com/file/test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//仅为示例，并非真实接口地址。</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">complete</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">downloadTask</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">abort</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>如果没有传入 success / fail / complete 参数，则会返回封装后的 Promise 对象：<a href="/leo-docs/api/README.html?id=promise-封装">Promise 封装</a></p><p>通过 <code>downloadTask</code>，可监听下载进度变化事件，以及取消下载任务。</p><p><strong>downloadTask 对象的方法列表</strong></p><table><thead><tr><th style="text-align:left;">方法</th><th style="text-align:left;">参数</th><th style="text-align:left;">说明</th><th style="text-align:left;">最低版本</th></tr></thead><tbody><tr><td style="text-align:left;">abort</td><td style="text-align:left;"></td><td style="text-align:left;">中断下载任务</td><td style="text-align:left;">*</td></tr><tr><td style="text-align:left;">onProgressUpdate</td><td style="text-align:left;">callback</td><td style="text-align:left;">监听下载进度变化</td><td style="text-align:left;">*</td></tr><tr><td style="text-align:left;">onHeadersReceived</td><td style="text-align:left;">callback</td><td style="text-align:left;">监听 HTTP Response Header 事件，会比请求完成事件更早,仅<code>微信小程序平台</code>支持，<a href="https://developers.weixin.qq.com/miniprogram/dev/api/DownloadTask.onHeadersReceived.html" target="_blank" rel="noreferrer">规范详情</a></td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">offProgressUpdate</td><td style="text-align:left;">callback</td><td style="text-align:left;">取消监听下载进度变化事件，仅<code>微信小程序平台</code>支持，<a href="https://developers.weixin.qq.com/miniprogram/dev/api/DownloadTask.offProgressUpdate.html" target="_blank" rel="noreferrer">规范详情</a></td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">offHeadersReceived</td><td style="text-align:left;">callback</td><td style="text-align:left;">取消监听 HTTP Response Header 事件，仅<code>微信小程序平台</code>支持，<a href="https://developers.weixin.qq.com/miniprogram/dev/api/DownloadTask.offHeadersReceived.html" target="_blank" rel="noreferrer">规范详情</a></td><td style="text-align:left;"></td></tr></tbody></table><p><strong>onProgressUpdate 返回参数说明</strong></p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">progress</td><td style="text-align:left;">Number</td><td style="text-align:left;">下载进度百分比</td></tr><tr><td style="text-align:left;">totalBytesWritten</td><td style="text-align:left;">Number</td><td style="text-align:left;">已经下载的数据长度，单位 Bytes</td></tr><tr><td style="text-align:left;">totalBytesExpectedToWrite</td><td style="text-align:left;">Number</td><td style="text-align:left;">预期需要下载的数据总长度，单位 Bytes</td></tr></tbody></table><p><strong>示例</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> downloadTask </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">downloadFile</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://www.example.com/file/test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//仅为示例，并非真实的资源</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">success</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">statusCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">下载成功</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">downloadTask</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onProgressUpdate</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">下载进度</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">progress</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">已经下载的数据长度</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">totalBytesWritten</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">预期需要下载的数据总长度</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">totalBytesExpectedToWrite</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;">// 满足测试条件，取消下载任务。</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">progress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">50</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">downloadTask</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">abort</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div>`,18),c=[o,p,r];function y(F,i,d,D,g,f){return e(),a("div",null,c)}const x=l(n,[["render",y]]);export{C as __pageData,x as default};
