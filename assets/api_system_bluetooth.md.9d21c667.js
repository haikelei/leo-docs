import{_ as t,c as s,o as a,N as n}from"./chunks/framework.fc67cb9d.js";const D=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"api/system/bluetooth.md","lastUpdated":1685603474000}'),o={name:"api/system/bluetooth.md"},e=n(`<p><strong>蓝牙 API 平台差异说明</strong></p><table><thead><tr><th style="text-align:center;">App</th><th style="text-align:center;">H5</th><th style="text-align:center;">微信小程序</th><th style="text-align:center;">支付宝小程序</th><th style="text-align:center;">百度小程序</th><th style="text-align:center;">字节跳动小程序</th><th style="text-align:center;">飞书小程序</th><th style="text-align:center;">QQ小程序</th><th style="text-align:center;">快手小程序</th><th style="text-align:center;">京东小程序</th></tr></thead><tbody><tr><td style="text-align:center;">√</td><td style="text-align:center;">x</td><td style="text-align:center;">√</td><td style="text-align:center;">√</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">√</td><td style="text-align:center;">x</td><td style="text-align:center;">x</td><td style="text-align:center;">√</td></tr></tbody></table><h3 id="uni-openbluetoothadapter-object" tabindex="-1">uni.openBluetoothAdapter(OBJECT) <a class="header-anchor" href="#uni-openbluetoothadapter-object" aria-label="Permalink to &quot;uni.openBluetoothAdapter(OBJECT)&quot;">​</a></h3><p>初始化蓝牙模块</p><p><strong>OBJECT 参数说明</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>success</td><td>function</td><td></td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td></td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td></td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><h4 id="错误" tabindex="-1">错误 <a class="header-anchor" href="#错误" aria-label="Permalink to &quot;错误&quot;">​</a></h4><table><thead><tr><th>错误码</th><th>错误信息</th><th>说明</th></tr></thead><tbody><tr><td>0</td><td>ok</td><td>正常</td></tr><tr><td>-1</td><td>already connect</td><td>已连接</td></tr><tr><td>10000</td><td>not init</td><td>未初始化蓝牙适配器</td></tr><tr><td>10001</td><td>not available</td><td>当前蓝牙适配器不可用</td></tr><tr><td>10002</td><td>no device</td><td>没有找到指定设备</td></tr><tr><td>10003</td><td>connection fail</td><td>连接失败</td></tr><tr><td>10004</td><td>no service</td><td>没有找到指定服务</td></tr><tr><td>10005</td><td>no characteristic</td><td>没有找到指定特征值</td></tr><tr><td>10006</td><td>no connection</td><td>当前连接已断开</td></tr><tr><td>10007</td><td>property not support</td><td>当前特征值不支持此操作</td></tr><tr><td>10008</td><td>system error</td><td>其余所有系统上报的异常</td></tr><tr><td>10009</td><td>system not support</td><td>Android 系统特有，系统版本低于 4.3 不支持 BLE</td></tr><tr><td>10010</td><td>already connect</td><td>已连接</td></tr><tr><td>10011</td><td>need pin</td><td>配对设备需要配对码</td></tr><tr><td>10012</td><td>operate time out</td><td>连接超时</td></tr><tr><td>10013</td><td>invalid_data</td><td>连接 deviceId 为空或者是格式不正确</td></tr></tbody></table><p><strong>注意</strong></p><ul><li>其他蓝牙相关 API 必须在 <a href="/leo-docs/api/system/bluetooth.html?id=openbluetoothadapter"><code>uni.openBluetoothAdapter</code></a> 调用之后使用。否则 API 会返回错误（errCode=10000）。</li><li>在用户蓝牙开关未开启或者手机不支持蓝牙功能的情况下，调用 <a href="/leo-docs/api/system/bluetooth.html?id=openbluetoothadapter"><code>uni.openBluetoothAdapter</code></a> 会返回错误（errCode=10001），表示手机蓝牙功能不可用。此时APP蓝牙模块已经初始化完成，可通过 <a href="/leo-docs/api/system/bluetooth.html?id=onbluetoothadapterstatechange"><code>uni.onBluetoothAdapterStateChange</code></a> 监听手机蓝牙状态的改变，也可以调用蓝牙模块的所有API。</li></ul><p><strong>示例代码</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">openBluetoothAdapter</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">success</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="uni-startbluetoothdevicesdiscovery-object" tabindex="-1">uni.startBluetoothDevicesDiscovery(OBJECT) <a class="header-anchor" href="#uni-startbluetoothdevicesdiscovery-object" aria-label="Permalink to &quot;uni.startBluetoothDevicesDiscovery(OBJECT)&quot;">​</a></h3><p>开始搜寻附近的蓝牙外围设备。<strong>此操作比较耗费系统资源，请在搜索并连接到设备后调用 <a href="/leo-docs/api/system/bluetooth.html?id=stopbluetoothdevicesdiscovery"><code>uni.stopBluetoothDevicesDiscovery</code></a> 方法停止搜索。</strong></p><p><strong>OBJECT 参数说明</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>services</td><td>Array&lt;String&gt;</td><td></td><td>否</td><td>要搜索的蓝牙设备主 service 的 uuid 列表。某些蓝牙设备会广播自己的主 service 的 uuid。如果设置此参数，则只搜索广播包有对应 uuid 的主服务的蓝牙设备。建议主要通过该参数过滤掉周边不需要处理的其他蓝牙设备。</td></tr><tr><td>allowDuplicatesKey</td><td>boolean</td><td>false</td><td>否</td><td>是否允许重复上报同一设备。如果允许重复上报，则 <code>uni.onBlueToothDeviceFound</code> 方法会多次上报同一设备，但是 RSSI 值会有不同。</td></tr><tr><td>interval</td><td>number</td><td>0</td><td>否</td><td>上报设备的间隔。0 表示找到新设备立即上报，其他数值根据传入的间隔上报。</td></tr><tr><td>powerLevel</td><td>string</td><td>medium</td><td>否</td><td>扫描模式，越高扫描越快，也越耗电，仅安卓支持。low：低，medium：中，high：高。仅京东小程序支持</td></tr><tr><td>success</td><td>function</td><td></td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td></td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td></td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><h4 id="错误-1" tabindex="-1">错误 <a class="header-anchor" href="#错误-1" aria-label="Permalink to &quot;错误&quot;">​</a></h4><table><thead><tr><th>错误码</th><th>错误信息</th><th>说明</th></tr></thead><tbody><tr><td>0</td><td>ok</td><td>正常</td></tr><tr><td>10000</td><td>not init</td><td>未初始化蓝牙适配器</td></tr><tr><td>10001</td><td>not available</td><td>当前蓝牙适配器不可用</td></tr><tr><td>10002</td><td>no device</td><td>没有找到指定设备</td></tr><tr><td>10003</td><td>connection fail</td><td>连接失败</td></tr><tr><td>10004</td><td>no service</td><td>没有找到指定服务</td></tr><tr><td>10005</td><td>no characteristic</td><td>没有找到指定特征值</td></tr><tr><td>10006</td><td>no connection</td><td>当前连接已断开</td></tr><tr><td>10007</td><td>property not support</td><td>当前特征值不支持此操作</td></tr><tr><td>10008</td><td>system error</td><td>其余所有系统上报的异常</td></tr><tr><td>10009</td><td>system not support</td><td>Android 系统特有，系统版本低于 4.3 不支持 BLE</td></tr><tr><td>10010</td><td>already connect</td><td>已连接</td></tr><tr><td>10011</td><td>need pin</td><td>配对设备需要配对码</td></tr><tr><td>10012</td><td>operate time out</td><td>连接超时</td></tr><tr><td>10013</td><td>invalid_data</td><td>连接 deviceId 为空或者是格式不正确</td></tr></tbody></table><p><strong>注意：</strong></p><ul><li>App 端目前仅支持发现ble蓝牙设备，更多蓝牙设备发现，可以使用 Native.js，参考：<a href="https://ask.dcloud.net.cn/article/114" target="_blank" rel="noreferrer">https://ask.dcloud.net.cn/article/114</a>。也可以在插件市场获取<a href="https://ext.dcloud.net.cn/search?q=%E8%93%9D%E7%89%99&amp;cat1=5&amp;cat2=51&amp;orderBy=UpdatedDate" target="_blank" rel="noreferrer">原生插件</a></li></ul><p><strong>示例代码</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 以微信硬件平台的蓝牙智能灯为例，主服务的 UUID 是 FEE7。传入这个参数，只搜索主服务 UUID 为 FEE7 的设备</span></span>
<span class="line"><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">startBluetoothDevicesDiscovery</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">services</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">FEE7</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">success</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="uni-onbluetoothdevicefound-callback" tabindex="-1">uni.onBluetoothDeviceFound(CALLBACK) <a class="header-anchor" href="#uni-onbluetoothdevicefound-callback" aria-label="Permalink to &quot;uni.onBluetoothDeviceFound(CALLBACK)&quot;">​</a></h3><p>监听寻找到新设备的事件</p><p><strong>CALLBACK 返回参数</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>devices</td><td>Array&lt;Object&gt;</td><td>新搜索到的设备列表</td></tr></tbody></table><p><strong>devices 的结构</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>蓝牙设备名称，某些设备可能没有</td></tr><tr><td>deviceId</td><td>string</td><td>用于区分设备的 id</td></tr><tr><td>RSSI</td><td>number</td><td>当前蓝牙设备的信号强度</td></tr><tr><td>advertisData</td><td>ArrayBuffer</td><td>当前蓝牙设备的广播数据段中的 ManufacturerData 数据段。</td></tr><tr><td>advertisServiceUUIDs</td><td>Array&lt;String&gt;</td><td>当前蓝牙设备的广播数据段中的 ServiceUUIDs 数据段</td></tr><tr><td>localName</td><td>string</td><td>当前蓝牙设备的广播数据段中的 LocalName 数据段</td></tr><tr><td>serviceData</td><td>Object</td><td>当前蓝牙设备的广播数据段中的 ServiceData 数据段，京东小程序不支持</td></tr></tbody></table><p><strong>注意</strong></p><ul><li>若在 <a href="/leo-docs/api/system/bluetooth.html?id=onbluetoothdevicefound"><code>uni.onBluetoothDeviceFound</code></a> 回调了某个设备，则此设备会添加到 <a href="/leo-docs/api/system/bluetooth.html?id=getbluetoothdevices"><code>uni.getBluetoothDevices</code></a> 接口获取到的数组中。</li></ul><p><strong>示例代码</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ArrayBuffer转16进度字符串示例</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ab2hex</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">buffer</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">hexArr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Array</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">map</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Uint8Array</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">buffer</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">bit</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">00</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bit</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">16</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">slice</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">hexArr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onBluetoothDeviceFound</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">devices</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">new device list has founded</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dir</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">devices</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">ab2hex</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">devices</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">advertisData</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="uni-stopbluetoothdevicesdiscovery-object" tabindex="-1">uni.stopBluetoothDevicesDiscovery(OBJECT) <a class="header-anchor" href="#uni-stopbluetoothdevicesdiscovery-object" aria-label="Permalink to &quot;uni.stopBluetoothDevicesDiscovery(OBJECT)&quot;">​</a></h3><p>停止搜寻附近的蓝牙外围设备。若已经找到需要的蓝牙设备并不需要继续搜索时，建议调用该接口停止蓝牙搜索。</p><p><strong>OBJECT 参数说明</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>success</td><td>function</td><td></td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td></td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td></td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><h4 id="错误-2" tabindex="-1">错误 <a class="header-anchor" href="#错误-2" aria-label="Permalink to &quot;错误&quot;">​</a></h4><table><thead><tr><th>错误码</th><th>错误信息</th><th>说明</th></tr></thead><tbody><tr><td>0</td><td>ok</td><td>正常</td></tr><tr><td>10000</td><td>not init</td><td>未初始化蓝牙适配器</td></tr><tr><td>10001</td><td>not available</td><td>当前蓝牙适配器不可用</td></tr><tr><td>10002</td><td>no device</td><td>没有找到指定设备</td></tr><tr><td>10003</td><td>connection fail</td><td>连接失败</td></tr><tr><td>10004</td><td>no service</td><td>没有找到指定服务</td></tr><tr><td>10005</td><td>no characteristic</td><td>没有找到指定特征值</td></tr><tr><td>10006</td><td>no connection</td><td>当前连接已断开</td></tr><tr><td>10007</td><td>property not support</td><td>当前特征值不支持此操作</td></tr><tr><td>10008</td><td>system error</td><td>其余所有系统上报的异常</td></tr><tr><td>10009</td><td>system not support</td><td>Android 系统特有，系统版本低于 4.3 不支持 BLE</td></tr><tr><td>10010</td><td>already connect</td><td>已连接</td></tr><tr><td>10011</td><td>need pin</td><td>配对设备需要配对码</td></tr><tr><td>10012</td><td>operate time out</td><td>连接超时</td></tr><tr><td>10013</td><td>invalid_data</td><td>连接 deviceId 为空或者是格式不正确</td></tr></tbody></table><p><strong>示例代码</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stopBluetoothDevicesDiscovery</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">success</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="uni-onbluetoothadapterstatechange-callback" tabindex="-1">uni.onBluetoothAdapterStateChange(CALLBACK) <a class="header-anchor" href="#uni-onbluetoothadapterstatechange-callback" aria-label="Permalink to &quot;uni.onBluetoothAdapterStateChange(CALLBACK)&quot;">​</a></h3><p>监听蓝牙适配器状态变化事件</p><p><strong>CALLBACK 返回参数</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>available</td><td>boolean</td><td>蓝牙适配器是否可用</td></tr><tr><td>discovering</td><td>boolean</td><td>蓝牙适配器是否处于搜索状态</td></tr></tbody></table><p><strong>示例代码</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onBluetoothAdapterStateChange</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">adapterState changed, now is</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="uni-getconnectedbluetoothdevices-object" tabindex="-1">uni.getConnectedBluetoothDevices(OBJECT) <a class="header-anchor" href="#uni-getconnectedbluetoothdevices-object" aria-label="Permalink to &quot;uni.getConnectedBluetoothDevices(OBJECT)&quot;">​</a></h3><p>根据 uuid 获取处于已连接状态的设备。</p><p><strong>OBJECT 参数说明</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>services</td><td>Array&lt;String&gt;</td><td></td><td>是</td><td>蓝牙设备主 service 的 uuid 列表</td></tr><tr><td>success</td><td>function</td><td></td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td></td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td></td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><p><strong>success 返回参数说明：</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>devices</td><td>Array&lt;Object&gt;</td><td>搜索到的设备列表</td></tr></tbody></table><p><strong>res.devices 的结构</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>蓝牙设备名称，某些设备可能没有</td></tr><tr><td>deviceId</td><td>string</td><td>用于区分设备的 id</td></tr></tbody></table><h4 id="错误-3" tabindex="-1">错误 <a class="header-anchor" href="#错误-3" aria-label="Permalink to &quot;错误&quot;">​</a></h4><table><thead><tr><th>错误码</th><th>错误信息</th><th>说明</th></tr></thead><tbody><tr><td>0</td><td>ok</td><td>正常</td></tr><tr><td>10000</td><td>not init</td><td>未初始化蓝牙适配器</td></tr><tr><td>10001</td><td>not available</td><td>当前蓝牙适配器不可用</td></tr><tr><td>10002</td><td>no device</td><td>没有找到指定设备</td></tr><tr><td>10003</td><td>connection fail</td><td>连接失败</td></tr><tr><td>10004</td><td>no service</td><td>没有找到指定服务</td></tr><tr><td>10005</td><td>no characteristic</td><td>没有找到指定特征值</td></tr><tr><td>10006</td><td>no connection</td><td>当前连接已断开</td></tr><tr><td>10007</td><td>property not support</td><td>当前特征值不支持此操作</td></tr><tr><td>10008</td><td>system error</td><td>其余所有系统上报的异常</td></tr><tr><td>10009</td><td>system not support</td><td>Android 系统特有，系统版本低于 4.3 不支持 BLE</td></tr><tr><td>10010</td><td>already connect</td><td>已连接</td></tr><tr><td>10011</td><td>need pin</td><td>配对设备需要配对码</td></tr><tr><td>10012</td><td>operate time out</td><td>连接超时</td></tr><tr><td>10013</td><td>invalid_data</td><td>连接 deviceId 为空或者是格式不正确</td></tr></tbody></table><p><strong>示例代码</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getConnectedBluetoothDevices</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">success</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="uni-getbluetoothdevices-object" tabindex="-1">uni.getBluetoothDevices(OBJECT) <a class="header-anchor" href="#uni-getbluetoothdevices-object" aria-label="Permalink to &quot;uni.getBluetoothDevices(OBJECT)&quot;">​</a></h3><p>获取在蓝牙模块生效期间所有已发现的蓝牙设备。包括已经和本机处于连接状态的设备。</p><p><strong>OBJECT 参数说明</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>success</td><td>function</td><td></td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td></td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td></td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><p><strong>success 返回参数说明：</strong></p><table><thead><tr><th style="text-align:left;">属性</th><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">devices</td><td style="text-align:left;">Array&lt;Object&gt;</td><td style="text-align:left;">uuid 对应的的已连接设备列表</td></tr></tbody></table><p><strong>res.devices 的结构</strong></p><p>|属性|类型|说明| |---|---|---|---| |name|string|蓝牙设备名称，某些设备可能没有| |deviceId|string|用于区分设备的 id| |RSSI|number|当前蓝牙设备的信号强度| |advertisData|ArrayBuffer|当前蓝牙设备的广播数据段中的 ManufacturerData 数据段。| |advertisServiceUUIDs|Array&lt;String&gt;|当前蓝牙设备的广播数据段中的 ServiceUUIDs 数据段| |localName|string|当前蓝牙设备的广播数据段中的 LocalName 数据段| |serviceData|Object|当前蓝牙设备的广播数据段中的 ServiceData 数据段|</p><h4 id="错误-4" tabindex="-1">错误 <a class="header-anchor" href="#错误-4" aria-label="Permalink to &quot;错误&quot;">​</a></h4><table><thead><tr><th>错误码</th><th>错误信息</th><th>说明</th></tr></thead><tbody><tr><td>0</td><td>ok</td><td>正常</td></tr><tr><td>10000</td><td>not init</td><td>未初始化蓝牙适配器</td></tr><tr><td>10001</td><td>not available</td><td>当前蓝牙适配器不可用</td></tr><tr><td>10002</td><td>no device</td><td>没有找到指定设备</td></tr><tr><td>10003</td><td>connection fail</td><td>连接失败</td></tr><tr><td>10004</td><td>no service</td><td>没有找到指定服务</td></tr><tr><td>10005</td><td>no characteristic</td><td>没有找到指定特征值</td></tr><tr><td>10006</td><td>no connection</td><td>当前连接已断开</td></tr><tr><td>10007</td><td>property not support</td><td>当前特征值不支持此操作</td></tr><tr><td>10008</td><td>system error</td><td>其余所有系统上报的异常</td></tr><tr><td>10009</td><td>system not support</td><td>Android 系统特有，系统版本低于 4.3 不支持 BLE</td></tr><tr><td>10012</td><td>operate time out</td><td>连接超时</td></tr><tr><td>10013</td><td>invalid_data</td><td>连接 deviceId 为空或者是格式不正确</td></tr></tbody></table><p><strong>示例代码</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ArrayBuffer转16进度字符串示例</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ab2hex</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">buffer</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">hexArr</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Array</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">map</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Uint8Array</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">buffer</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">bit</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">00</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bit</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">16</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">slice</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">hexArr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getBluetoothDevices</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">success</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">devices</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">ab2hex</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">devices</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">advertisData</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p><strong>注意</strong></p><ul><li>该接口获取到的设备列表为<strong>蓝牙模块生效期间所有搜索到的蓝牙设备</strong>，若在蓝牙模块使用流程结束后未及时调用 <a href="/leo-docs/api/system/bluetooth.html?id=closebluetoothadapter"><code>uni.closeBluetoothAdapter</code></a> 释放资源，会存在调用该接口会返回之前的蓝牙使用流程中搜索到的蓝牙设备，可能设备已经不在用户身边，无法连接。</li><li>蓝牙设备在被搜索到时，系统返回的 name 字段一般为广播包中的 LocalName 字段中的设备名称，而如果与蓝牙设备建立连接，系统返回的 name 字段会改为从蓝牙设备上获取到的 <code>GattName</code>。若需要动态改变设备名称并展示，建议使用 <code>localName</code> 字段。</li></ul><h3 id="uni-getbluetoothadapterstate-object" tabindex="-1">uni.getBluetoothAdapterState(OBJECT) <a class="header-anchor" href="#uni-getbluetoothadapterstate-object" aria-label="Permalink to &quot;uni.getBluetoothAdapterState(OBJECT)&quot;">​</a></h3><p>获取本机蓝牙适配器状态。</p><p><strong>OBJECT 参数说明</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>success</td><td>function</td><td></td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td></td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td></td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><p><strong>success 返回参数说明：</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>discovering</td><td>boolean</td><td>是否正在搜索设备</td></tr><tr><td>available</td><td>boolean</td><td>蓝牙适配器是否可用</td></tr></tbody></table><h4 id="错误-5" tabindex="-1">错误 <a class="header-anchor" href="#错误-5" aria-label="Permalink to &quot;错误&quot;">​</a></h4><table><thead><tr><th>错误码</th><th>错误信息</th><th>说明</th></tr></thead><tbody><tr><td>0</td><td>ok</td><td>正常</td></tr><tr><td>10000</td><td>not init</td><td>未初始化蓝牙适配器</td></tr><tr><td>10001</td><td>not available</td><td>当前蓝牙适配器不可用</td></tr><tr><td>10002</td><td>no device</td><td>没有找到指定设备</td></tr><tr><td>10003</td><td>connection fail</td><td>连接失败</td></tr><tr><td>10004</td><td>no service</td><td>没有找到指定服务</td></tr><tr><td>10005</td><td>no characteristic</td><td>没有找到指定特征值</td></tr><tr><td>10006</td><td>no connection</td><td>当前连接已断开</td></tr><tr><td>10007</td><td>property not support</td><td>当前特征值不支持此操作</td></tr><tr><td>10008</td><td>system error</td><td>其余所有系统上报的异常</td></tr><tr><td>10009</td><td>system not support</td><td>Android 系统特有，系统版本低于 4.3 不支持 BLE</td></tr><tr><td>10010</td><td>already connect</td><td>已连接</td></tr><tr><td>10011</td><td>need pin</td><td>配对设备需要配对码</td></tr><tr><td>10012</td><td>operate time out</td><td>连接超时</td></tr><tr><td>10013</td><td>invalid_data</td><td>连接 deviceId 为空或者是格式不正确</td></tr></tbody></table><p><strong>示例代码</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getBluetoothAdapterState</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">success</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="uni-closebluetoothadapter-object" tabindex="-1">uni.closeBluetoothAdapter(OBJECT) <a class="header-anchor" href="#uni-closebluetoothadapter-object" aria-label="Permalink to &quot;uni.closeBluetoothAdapter(OBJECT)&quot;">​</a></h3><p>关闭蓝牙模块。调用该方法将断开所有已建立的连接并释放系统资源。建议在使用蓝牙流程后，与 <a href="/leo-docs/api/system/bluetooth.html?id=openbluetoothadapter"><code>uni.openBluetoothAdapter</code></a> 成对调用。</p><p><strong>OBJECT 参数说明</strong></p><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>success</td><td>function</td><td></td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td></td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td></td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）</td></tr></tbody></table><h4 id="错误-6" tabindex="-1">错误 <a class="header-anchor" href="#错误-6" aria-label="Permalink to &quot;错误&quot;">​</a></h4><table><thead><tr><th>错误码</th><th>错误信息</th><th>说明</th></tr></thead><tbody><tr><td>0</td><td>ok</td><td>正常</td></tr><tr><td>10000</td><td>not init</td><td>未初始化蓝牙适配器</td></tr><tr><td>10001</td><td>not available</td><td>当前蓝牙适配器不可用</td></tr><tr><td>10002</td><td>no device</td><td>没有找到指定设备</td></tr><tr><td>10003</td><td>connection fail</td><td>连接失败</td></tr><tr><td>10004</td><td>no service</td><td>没有找到指定服务</td></tr><tr><td>10005</td><td>no characteristic</td><td>没有找到指定特征值</td></tr><tr><td>10006</td><td>no connection</td><td>当前连接已断开</td></tr><tr><td>10007</td><td>property not support</td><td>当前特征值不支持此操作</td></tr><tr><td>10008</td><td>system error</td><td>其余所有系统上报的异常</td></tr><tr><td>10009</td><td>system not support</td><td>Android 系统特有，系统版本低于 4.3 不支持 BLE</td></tr><tr><td>10010</td><td>already connect</td><td>已连接</td></tr><tr><td>10011</td><td>need pin</td><td>配对设备需要配对码</td></tr><tr><td>10012</td><td>operate time out</td><td>连接超时</td></tr><tr><td>10013</td><td>invalid_data</td><td>连接 deviceId 为空或者是格式不正确</td></tr></tbody></table><p><strong>示例代码</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">closeBluetoothAdapter</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">success</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div>`,90),l=[e];function d(p,r,c,i,y,F){return a(),s("div",null,l)}const A=t(o,[["render",d]]);export{D as __pageData,A as default};
